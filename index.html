<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Limerence</title>

<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
body {
    margin: 0;
    padding: 0;
    background: black;
    font-family: Arial, sans-serif;
    overflow: hidden;
}

/* Background */
#backgroundContainer {
    display: none;
    position: fixed;
    inset: 0;
    background: url("craftg.gif") no-repeat center center fixed;
    background-size: cover;
}

.overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.25);
    z-index: 1;
}

/* Subtitles */
.content {
    position: relative;
    z-index: 10;
    text-align: center;
    padding-top: 20%;
}

.content p {
    font-family: 'Press Start 2P', monospace;
    font-size: 1.5rem;
    color: #ffdf9a;
    text-shadow: 0 0 8px #ffdf9a, 0 0 18px #ffdf9a55;
    opacity: 0;
    transition: opacity 0.5s ease;
    line-height: 1.4em;
    margin: 0.3em 0;
}

/* Play button */
#playButton {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    padding: 18px 45px;
    font-size: 1.6rem;
    cursor: pointer;
    z-index: 9999;
    background: rgba(20,20,20,0.6);
    backdrop-filter: blur(6px);
    border-radius: 14px;
    color: #e8e8e8;
    border: 1px solid rgba(255,255,255,0.1);
}

#playButton:hover {
    transform: translate(-50%, -50%) scale(1.07);
}

/* Like UI */
#likeContainer {
    position: fixed;
    top: 65%;
    left: 50%;
    transform: translateX(-50%);
    text-align: center;
    display: none;
    z-index: 9999;
}

#likeButton {
    font-size: 3rem;
    background: none;
    border: none;
    color: #ffffffa8;
    cursor: pointer;
}

#likeButton.liked {
    color: #ffdf9a;
    text-shadow: 0 0 12px #ffdf9a;
    animation: pulse 0.5s ease;
}

#likeCount {
    margin-top: 10px;
    font-family: 'Press Start 2P', monospace;
    color: #ffdf9a;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.35); }
    100% { transform: scale(1); }
}

/* Floating hearts */
.floating-heart {
    position: fixed;
    left: 50%;
    top: 65%;
    transform: translateX(-50%);
    font-size: 1.8rem;
    color: #ffdf9a;
    animation: floatUp 1.6s ease-out forwards;
    pointer-events: none;
}

@keyframes floatUp {
    to {
        opacity: 0;
        transform: translate(-50%, -120px) scale(1.8);
    }
}

/* Particles */
.particle {
    position: fixed;
    font-size: 1rem;
    color: #ffdf9a;
    animation: particleFly 0.9s ease-out forwards;
    pointer-events: none;
}

@keyframes particleFly {
    to {
        opacity: 0;
        transform: translate(var(--dx), var(--dy)) scale(0.2);
    }
}
</style>
</head>

<body>

<button id="playButton">Mellifluous</button>

<div id="likeContainer">
    <button id="likeButton">♡</button>
    <div id="likeCount">0</div>
</div>

<div id="backgroundContainer">
    <div class="overlay"></div>
    <div class="content">
        <p id="subtitle"></p>
    </div>
</div>

<audio id="myAudio"></audio>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<script>
// --------------------
// Elements
// --------------------
const btn = document.getElementById("playButton");
const likeBtn = document.getElementById("likeButton");
const likeContainer = document.getElementById("likeContainer");
const likeCountDisplay = document.getElementById("likeCount");
const audio = document.getElementById("myAudio");
const bg = document.getElementById("backgroundContainer");
const subtitle = document.getElementById("subtitle");

// --------------------
// Firebase
// --------------------
firebase.initializeApp({
  apiKey: "AIzaSyBT00PFXmX0oNf5puYDZ20Vg-qkyBRTQgs",
  authDomain: "limerence-61ccc.firebaseapp.com",
  projectId: "limerence-61ccc",
  storageBucket: "limerence-61ccc.firebasestorage.app",
  messagingSenderId: "365628060522",
  appId: "1:365628060522:web:60aa2c63eb82b1628cab13"
});

const likeRef = firebase.database().ref("likes");

// --------------------
// Songs (RANDOMIZED)
// --------------------
const songs = [
  {
    src: "White Ferrari.mp3",
    subtitles: [
    { start:3, end:6, text:"I'm sure we're taller<br>in another Dimension" },
    { start:7, end:10, text:"You say we're smaller<br>and not worth the mention" },
    { start:11, end:15, text:"You're tired of movin',<br>your body's achin'" },
    { start:15, end:19, text:"We could vacay,<br>there's places to go" },
    { start:20, end:24, text:"Clearly, this isn't all<br>that there is" },
    { start:24, end:26, text:"Can't take what's been given" },
    { start:26, end:30, text:"But we're so okay here,<br>we're doing fine" },
    { start:31, end:32, text:"Primal and naked" },
    { start:33, end:37, text:"You dream of walls<br>that hold us in prison" },
    { start:37, end:41, text:"It's just a skull,<br>least that's what they call it" },
    { start:41, end:43, text:"And we're free to roam" }
    ]
  },
  {
    src: "Let down.mp3", 
    subtitles: [
      { start:4, end:10, text:"You know,<br>you know where you are with" },
      { start:11, end:14, text:"You know where you are with" },
      { start:15, end:19, text:"Floor collapses, floating" },
      { start:20, end:24, text:"Bouncing back And one day" },
      { start:24.5, end:29, text:"I am Gonna grow wings" },
      { start:29.5, end:32, text:"You know where you are with" },
      { start:33, end:37, text:"Hysterical and useless" },
      { start:38, end:46, text:"Hysterical and- Let down,<br>and hanging around" },
      { start:47, end:54, text:"Crushed like a bug in the ground" },
      { start:55, end:100, text:"Let down, and hanging around" }
    ]
  },
  {
    src: "",







  }
];

const selectedSong = songs[Math.floor(Math.random() * songs.length)];
audio.src = selectedSong.src;
let subtitles = selectedSong.subtitles;

// --------------------
// Play
// --------------------
btn.onclick = () => {
    audio.play();
    btn.style.display = "none";
    bg.style.display = "block";
    likeContainer.style.display = "block";
};

// --------------------
// Likes
// --------------------
let liked = false;

likeRef.on("value", snap => {
    likeCountDisplay.textContent = snap.val() || 0;
});

likeBtn.onclick = () => {
    liked = !liked;
    likeBtn.textContent = liked ? "❤" : "♡";
    likeBtn.classList.toggle("liked", liked);
    likeRef.transaction(v => liked ? (v||0)+1 : Math.max((v||0)-1,0));
    if(liked) spawnEffects();
};

function spawnEffects(){
    spawnFloatingHeart();
    for(let i=0;i<12;i++){
        const p = document.createElement("div");
        p.className = "particle";
        p.textContent = "❤";
        const a = (Math.PI*2*i)/12;
        p.style.left = innerWidth/2+"px";
        p.style.top = innerHeight*0.65+"px";
        p.style.setProperty("--dx", Math.cos(a)*80+"px");
        p.style.setProperty("--dy", Math.sin(a)*80+"px");
        document.body.appendChild(p);
        setTimeout(()=>p.remove(),900);
    }
}

function spawnFloatingHeart(){
    const h = document.createElement("div");
    h.className = "floating-heart";
    h.textContent = "❤";
    document.body.appendChild(h);
    setTimeout(()=>h.remove(),1600);
}

// --------------------
// Subtitles
// --------------------
let currentIndex = -1;

audio.ontimeupdate = () => {
    const t = audio.currentTime;
    const i = subtitles.findIndex(s => t>=s.start && t<s.end);
    if(i !== currentIndex){
        currentIndex = i;
        subtitle.style.opacity = i === -1 ? 0 : 1;
        if(i !== -1) subtitle.innerHTML = subtitles[i].text;
    }
};
</script>

</body>
</html>
